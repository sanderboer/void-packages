# Template file for 'ifcopenshell'
pkgname=ifcopenshell
version=0.6.0b0
revision=1
#archs="i686 x86_64"
wrksrc="IfcOpenShell-${version}"
build_style=cmake
_blenderversion=2.80
#create_wrksrc=yes
configure_args="
-Wno-dev
-DCMAKE_INSTALL_PREFIX=/usr
-DOCC_INCLUDE_DIR=/usr/include/opencascade
-Dgp_Pnt_hxx=/usr/include/opencascade/gp_Pnt.hxx
-DPYTHON_INCLUDE_DIR=/usr/include/python3.8
-DPYTHON_EXECUTABLE=/bin/python3
-DPYTHON_LIBRARY=/usr/lib/libpython3.8.so
-DLIBXML2_INCLUDE_DIR=/usr/include/libxml2
-DLIBXML2_LIBRARIES=/usr/lib/libxml2.so
-DSWIG_DIR=/usr/share/swig/3.0.12
-DSWIG_EXECUTABLE=/bin/swig3
-DSWIG_VERSION=3.0.12
../cmake/
"
patch_args="-Np1"
hostmakedepends="swig3"
makedepends="python3-devel boost-devel occt-devel icu-devel libxml2-devel opencollada-devel pcre-devel"
depends="python3 boost occt libxml2 opencollada icu"

short_desc="Open source ifc toolkit and geometry engine. Provides IfcConvert IfcGeomserver, ifcopenshell python bindings and blender ifc import addon"
maintainer="Sander Boer <sanderboer@mauc.nl>"
license="LGPL-v3.0"
homepage="http://www.ifcopenshell.org/"
distfiles="https://github.com/IfcOpenShell/IfcOpenShell/archive/v${version}.tar.gz"
checksum=d4a9a28b715512659670f2a101bef64363df7808a64ed30e7019161caae6a914

post_install(){
  vmkdir usr/share/blender/${_blenderversion}/scripts/addons_contrib
  vcopy src/ifcblender/* usr/share/blender/${_blenderversion}/scripts/addons_contrib/
  #vmkdir usr/lib/ifcblender
  #vcopy src/ifcopenshell-python/* usr/lib/ifcblender/io_import_scene_ifc/
  #vcopy build/ifcwrap/*ifcopenshell_wrapper* usr/lib/ifcblender/io_import_scene_ifc/ifcopenshell/
  #ln -s /usr/lib/ifcblender/io_import_scene_ifc ${DESTDIR}/usr/share/blender/${_blenderversion}/scripts/addons_contrib/
  }

# NOTE: ifcblender is patched to use system-wide installed ifcopenshell python bindings.
# NOTE: Default is that the ifcopenshell module is copied into the ifcblender dir, which includes ELF binairies.
# NOTE: This is not allowed, the workaround is commented out to install ifcblender and binaries into /usr/lib/ifcblender and symlink it to the blender addon dir.
